{% extends "base.html" %}
{% block content %}

<h2>Admin: Users</h2>

<table border="1" cellspacing="0" cellpadding="8">
  <tr>
    <th>ID</th>
    <th>Email</th>
    <th>Pro</th>
    <th>Admin</th>
    <th>Scans Used</th>
    <th>Actions</th>
  </tr>

  {% for u in users %}
  <tr>
    <td>{{ u.id }}</td>
    <td>{{ u.email }}</td>
    <td>{{ u.is_pro }}</td>
    <td>{{ u.is_admin }}</td>
    <td>{{ u.scans_used }}</td>
    <td>
      <a href="#" 
         data-id="{{ u.id }}"
         data-email="{{ u.email }}"
         data-pro="{{ u.is_pro }}"
         data-admin="{{ u.is_admin }}"
         onclick="openEditModal(this)">
         Edit
      </a>
      |
      <a href="/admin/delete/{{ u.id }}">Delete</a>
      |
      <a href="/admin/reset_scans/{{ u.id }}">Reset Scans</a>
    </td>
  </tr>
  {% endfor %}
</table>


<!-- ============================================================
     EDIT USER MODAL
=============================================================== -->
<div id="editModal" style="
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.6);
    display: none;
    justify-content: center;
    align-items: center;
">
  <div style="
      background: white;
      padding: 25px;
      width: 400px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
  ">
    <h3>Edit User</h3>

    <form id="editForm" method="POST">

      <label>Email:</label><br>
      <input type="text" name="email" id="editEmail" style="width:100%; padding:8px;"><br><br>

      <label>New Password (optional):</label><br>
      <input type="password" name="password" id="editPassword" style="width:100%; padding:8px;"><br><br>

      <label>
        <input type="checkbox" name="is_pro" id="editPro">
        Pro User
      </label><br><br>

      <label>
        <input type="checkbox" name="is_admin" id="editAdmin">
        Admin
      </label><br><br>

      <button type="submit" style="
          padding: 10px 15px;
          background: #4CAF50;
          color: white;
          border: none;
          border-radius: 5px;
          cursor: pointer;
      ">Save</button>

      <button type="button" onclick="closeModal()" style="
          padding: 10px 15px;
          background: #999;
          color: white;
          border: none;
          border-radius: 5px;
          cursor: pointer;
      ">Cancel</button>

    </form>
  </div>
</div>


<!-- ============================================================
     MODAL SCRIPT
=============================================================== -->
<script>
function openEditModal(el) {
    let id = el.getAttribute("data-id");
    let email = el.getAttribute("data-email");
    let pro = el.getAttribute("data-pro") === "True";
    let admin = el.getAttribute("data-admin") === "True";

    // Fill modal values
    document.getElementById("editEmail").value = email;
    document.getElementById("editPro").checked = pro;
    document.getElementById("editAdmin").checked = admin;

    // Set form action
    document.getElementById("editForm").action = "/admin/update/" + id;

    // Show modal
    document.getElementById("editModal").style.display = "flex";
}

function closeModal() {
    document.getElementById("editModal").style.display = "none";
}
</script>

{% endblock %}

