{% extends "base.html" %}
{% block content %}

<style>

/* PAGE STRUCTURE */
.dashboard-container {
    max-width: 900px;
    margin: 40px auto;
    padding: 0 20px;
    font-family: 'Inter', sans-serif;
}

/* HEADER BANNER */
.header-banner {
    width: 100%;
    padding: 45px 0;
    text-align: center;
    background: linear-gradient(135deg, #6A4CFF, #9C6BFF);
    color: white;
    border-radius: 14px;
    margin-bottom: 35px;
}

.header-banner h1 {
    font-size: 38px;
    font-weight: 800;
    margin-bottom: 10px;
}

.header-banner p {
    font-size: 17px;
    opacity: 0.9;
}

/* CARD */
.card {
    background: white;
    border-radius: 16px;
    padding: 28px;
    margin-bottom: 35px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.07);
}

.section-title {
    font-size: 22px;
    font-weight: 700;
    margin-bottom: 20px;
    color: #333;
}

/* INPUT ROW */
.input-row {
    display: flex;
    gap: 12px;
    margin-bottom: 12px;
}

input[type="url"], input[type="text"] {
    flex: 1;
    padding: 14px 16px;
    border: 1px solid #ccc;
    border-radius: 10px;
    font-size: 15px;
}

.run-btn {
    padding: 14px 20px;
    background: #6A4CFF;
    color: white;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-weight: 700;
    transition: 0.2s;
}

.run-btn:hover {
    background: #563ae6;
}

/* SCORE CIRCLE */
.score-circle {
    width: 160px;
    height: 160px;
    border-radius: 50%;
    background: conic-gradient(#6A4CFF var(--percent), #eee 0deg);
    margin: 0 auto 15px auto;
    position: relative;
}

.score-circle-inner {
    width: 110px;
    height: 110px;
    background: white;
    border-radius: 50%;
    position: absolute;
    top: 25px;
    left: 25px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 34px;
    font-weight: 800;
    color: #333;
}

/* LIMIT WARNING */
.limit-box {
    max-width: 700px;
    margin: 0 auto 25px auto;
    background: #fff1f1;
    padding: 22px;
    border-radius: 14px;
    border: 1px solid #ffb8b8;
    text-align: center;
}

.limit-box h2 {
    color: #b00000;
    font-size: 24px;
}

/* BUTTONS */
.purple-btn {
    padding: 12px 18px;
    background:#6A4CFF;
    color:white;
    border-radius:10px;
    text-decoration:none;
    font-weight:700;
}

.green-btn {
    padding: 12px 18px;
    background:#00a86b;
    color:white;
    border-radius:10px;
    text-decoration:none;
    font-weight:700;
}

</style>


<div class="dashboard-container">

    <!-- FREE LIMIT REACHED -->
    {% if limit_reached %}
    <div class="limit-box">
        <h2>You‚Äôve hit your free monthly limit!</h2>
        <p>You get 3 free scans and 1 PDF export. Upgrade or buy more scans to continue.</p>

        <div style="margin-top:15px;">
            <a href="/upgrade" class="purple-btn" style="margin-right:10px;">Upgrade to Pro ‚Äì $4.99/mo</a>
            <a href="/buy-scan" class="green-btn">Buy 1 Scan ‚Äì $0.99</a>
        </div>
    </div>
    {% endif %}


    <!-- CURRENT USAGE -->
    <div class="card">
        <div class="section-title">Your Usage</div>

        <p style="font-size:16px; color:#444; margin-bottom:10px;">
            <strong>Scans Used:</strong> {{ user.scans_used }} / 3 (Free Tier)
        </p>

        <p style="font-size:16px; color:#444;">
            <strong>PDF Exports Used:</strong> {{ user.pdf_downloads_used }} / 1 (Free Tier)
        </p>
    </div>


    <!-- SEO ANALYZER -->
    <div class="card">
        <div class="section-title">üîç SEO Analyzer</div>

        {% if not limit_reached %}
        <form method="POST">
            <div class="input-row">
                <input type="url" name="website_url" placeholder="Website URL" required>
                <button class="run-btn" type="submit">Run Scan</button>
            </div>

            <small style="color:#6A4CFF; cursor:pointer;"
                onclick="
                    document.getElementById('manual-keyword').style.display='block';
                    this.style.display='none';
                ">
                + Add keyword manually (optional)
            </small>

            <input type="text" id="manual-keyword" name="keyword"
                   placeholder="Keyword (optional)"
                   style="display:none; margin-top:10px;">
        </form>
        {% else %}
        <p style="color:#b00000;">Upgrade or buy a scan to run more audits.</p>
        {% endif %}

        <!-- Suggested Keywords -->
        {% if suggested_keywords %}
        <div style="margin-top:20px;">
            <strong>Suggested Keywords:</strong><br><br>
            {% for kw in suggested_keywords %}
            <span style="
                background:#eee;
                padding:6px 10px;
                margin:4px;
                display:inline-block;
                border-radius:8px;
                font-size:14px;
            ">
                {{ kw }}
            </span>
            {% endfor %}
        </div>
        {% endif %}
    </div>


    <!-- KEYWORD SCORE -->
    {% if keyword_score %}
    <div class="card">
        <div class="section-title">üìà Keyword Score</div>

        <!-- Score Circle -->
        <div class="score-circle" style="--percent: {{ score_percent }}deg;">
            <div class="score-circle-inner">{{ score_number }}</div>
        </div>

        <p style="text-align:center; color:#444; margin-top:10px;">
            Keyword relevance score: {{ score_number }} / 100
        </p>
    </div>
    {% endif %}


    <!-- SITE AUDIT -->
    {% if site_audit %}
    <div class="card">
        <div class="section-title">üßπ Site Audit</div>
        <pre style="white-space:pre-wrap; font-size:15px; color:#333;">{{ site_audit }}</pre>
    </div>
    {% endif %}


    <!-- OPTIMIZATION TIPS -->
    {% if optimization_tips %}
    <div class="card">
        <div class="section-title">üí° Optimization Tips</div>
        <pre style="white-space:pre-wrap; font-size:15px; color:#333;">{{ optimization_tips }}</pre>
    </div>
    {% endif %}

</div>

{% endblock %}
