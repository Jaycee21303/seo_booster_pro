{% extends "base.html" %}
{% block title %}Elite SEO Dashboard & Analyzer | SEO Booster Pro{% endblock %}
{% block meta_extra %}
<meta name="description" content="SEO Booster Pro dashboard delivers elite on-page SEO analysis with AI narration, live screenshots, and executive-ready reporting.">
<meta name="keywords" content="enterprise seo dashboard, seo analyzer, website audit, search engine optimization tool, seo booster pro">
<meta property="og:title" content="Elite SEO Dashboard & Analyzer">
<meta property="og:description" content="Enterprise-grade SEO intelligence with AI storytelling, live screenshots, and actionable insights.">
<meta property="og:type" content="website">
<meta property="og:image" content="https://seo-booster-pro.example/og-image-dashboard.png">
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "SoftwareApplication",
  "name": "SEO Booster Pro Dashboard",
  "applicationCategory": "SEO",
  "operatingSystem": "Any",
  "description": "Enterprise SEO dashboard with AI-led analysis, live previews, and executive-ready insights.",
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": "4.9",
    "reviewCount": "218"
  }
}
</script>
{% endblock %}
{% block content %}

<style>
:root {
    --bg: #060b1a;
    --panel: rgba(255,255,255,0.04);
    --card: #0f172a;
    --card-border: rgba(255,255,255,0.06);
    --accent: #8b5cf6;
    --accent-2: #22d3ee;
    --text: #e5e7eb;
    --muted: #94a3b8;
    --success: #22c55e;
    --warning: #f59e0b;
    --danger: #ef4444;
    --shadow: 0 18px 50px rgba(0,0,0,0.45);
}

body {
    background: radial-gradient(circle at 20% 20%, rgba(104, 64, 255, 0.12), transparent 35%),
                radial-gradient(circle at 70% 0%, rgba(37, 195, 255, 0.12), transparent 35%),
                #060b1a;
    font-family: 'Inter', sans-serif;
    color: var(--text);
}

.dashboard-shell {
    max-width: 1240px;
    margin: 0 auto;
    padding: 18px 18px 70px;
}

.seo-tags {
    position: absolute;
    left: -9999px;
    visibility: hidden;
}

.dashboard-hero {
    background: linear-gradient(135deg, rgba(15,23,42,0.9), rgba(28,35,54,0.9));
    border: 1px solid var(--card-border);
    border-radius: 22px;
    padding: 30px 34px;
    box-shadow: var(--shadow);
    position: relative;
    overflow: hidden;
    margin-bottom: 22px;
}

.dashboard-hero:after {
    content: "";
    position: absolute;
    inset: 0;
    background: radial-gradient(circle at 80% 20%, rgba(139,92,246,0.28), transparent 45%);
    pointer-events: none;
}

.hero-top {
    display: flex;
    justify-content: space-between;
    gap: 18px;
    flex-wrap: wrap;
}

.breadcrumbs {
    color: var(--muted);
    font-size: 13px;
    letter-spacing: 0.4px;
    text-transform: uppercase;
}

.dash-title {
    font-size: 36px;
    font-weight: 800;
    margin: 6px 0;
    letter-spacing: -0.3px;
}

.dash-subtitle {
    font-size: 15px;
    max-width: 780px;
    color: #cbd5f5;
    line-height: 1.8;
}

.hero-pills {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    margin-top: 12px;
}

.hero-pill {
    background: rgba(255,255,255,0.08);
    border: 1px solid rgba(255,255,255,0.08);
    color: var(--text);
    padding: 9px 12px;
    border-radius: 12px;
    font-weight: 700;
    font-size: 13px;
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

.hero-actions {
    display: grid;
    gap: 12px;
    align-items: start;
    min-width: 260px;
}

.hero-actions .primary-btn {
    box-shadow: 0 18px 40px rgba(124, 95, 255, 0.35);
    padding: 14px 16px;
}

.hero-microcopy {
    font-size: 13px;
    color: var(--muted);
}

.page-wrapper {
    display: grid;
    grid-template-columns: 1fr 300px;
    gap: 20px;
}

.dashboard-container { width: 100%; }
.sidebar-ads { position: sticky; top: 90px; }

.card {
    background: linear-gradient(145deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
    border: 1px solid var(--card-border);
    border-radius: 18px;
    padding: 22px;
    box-shadow: var(--shadow);
    margin-bottom: 18px;
    backdrop-filter: blur(6px);
}

.section-title {
    font-size: 18px;
    font-weight: 800;
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 8px;
}

.section-sub { color: var(--muted); font-size: 14px; margin-bottom: 18px; }

.analyzer-form { display: grid; grid-template-columns: 1.4fr 0.6fr; gap: 12px; align-items: center; }
.analyzer-form .stack { display: grid; gap: 10px; }
.input-field { padding: 14px 16px; border: 1px solid rgba(255,255,255,0.12); border-radius: 12px; font-size: 15px; width: 100%; background: rgba(255,255,255,0.04); color: #f8fafc; }
.input-field::placeholder { color: #94a3b8; }
.input-field:focus { outline: none; border-color: var(--accent-2); box-shadow: 0 0 0 3px rgba(34,211,238,0.14); }

.primary-btn { background: linear-gradient(135deg, var(--accent), #4f46e5); border: none; color: white; padding: 14px 18px; border-radius: 12px; font-weight: 800; font-size: 15px; cursor: pointer; transition: transform 0.15s ease; width: 100%; }
.primary-btn:hover { transform: translateY(-1px); }

.tagline { font-size: 13px; color: var(--muted); display: flex; align-items: center; gap: 8px; }
.tagline span { background: rgba(34,211,238,0.12); color: #67e8f9; padding: 6px 10px; border-radius: 10px; font-weight: 700; }

.upgrade-banner { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.12); padding: 16px 18px; border-radius: 14px; margin-bottom: 18px; display: flex; align-items: center; justify-content: space-between; box-shadow: var(--shadow); }
.upgrade-banner h3 { margin: 0; font-weight: 800; color: #e5e7eb; }
.upgrade-banner p { margin: 6px 0 0 0; color: var(--muted); }
.upgrade-btn { background: linear-gradient(135deg, #22d3ee, #4f46e5); color: white; padding: 12px 18px; border-radius: 10px; font-weight: 800; text-decoration: none; box-shadow: 0 10px 26px rgba(79,70,229,0.35); }

.results-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 16px; }

.score-shell { display: grid; grid-template-columns: auto 1fr; gap: 18px; align-items: center; }
.score-circle { width: 170px; height: 170px; border-radius: 50%; background: conic-gradient(#1e293b 0deg, #1e293b 360deg); display: flex; align-items: center; justify-content: center; box-shadow: inset 0 0 0 14px rgba(255,255,255,0.05); }
.score-circle-inner { width: 120px; height: 120px; background: #0b1221; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 38px; font-weight: 800; color: #f8fafc; box-shadow: 0 10px 30px rgba(0,0,0,0.35); }
.score-meta { display: grid; gap: 8px; }
.badge { display: inline-flex; align-items: center; gap: 8px; padding: 8px 12px; border-radius: 12px; background: rgba(255,255,255,0.06); color: #e5e7eb; font-weight: 600; font-size: 13px; }
.badge.good { background: rgba(34,197,94,0.18); color: #bbf7d0; }
.badge.warn { background: rgba(245,158,11,0.18); color: #fed7aa; }
.badge.neutral { background: rgba(79,70,229,0.18); color: #c7d2fe; }

.ai-box { background: linear-gradient(145deg, #0b1221, #0f172a); color: #e5e7eb; position: relative; overflow: hidden; border: 1px solid rgba(255,255,255,0.1); }
.ai-box:after { content: ""; position: absolute; inset: 0; background: radial-gradient(circle at 80% 20%, rgba(255,255,255,0.06), transparent 40%); pointer-events: none; }
.ai-header { display: flex; align-items: center; justify-content: space-between; gap: 10px; color: #cbd5f5; font-weight: 700; margin-bottom: 10px; }
.ai-voice { font-size: 15px; line-height: 1.7; color: #e5e7eb; }
.ai-footnote { color: var(--muted); font-size: 13px; margin-top: 10px; }
.ai-pill { background: rgba(34,211,238,0.12); color: #67e8f9; padding: 6px 10px; border-radius: 10px; font-weight: 700; font-size: 12px; }

.preview-card img { width: 100%; border-radius: 14px; border: 1px solid rgba(255,255,255,0.08); box-shadow: var(--shadow); background: #0b1221; }
.preview-note { margin-top: 8px; font-size: 13px; color: var(--muted); }

.intel-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 12px; }
.info-pill { padding: 12px 14px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.04); font-weight: 700; color: #f8fafc; }
.pill-sub { display: block; font-size: 12px; color: var(--muted); font-weight: 500; margin-top: 4px; }
.keyword-pills { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; }
.keyword-pills span { background: rgba(79,70,229,0.2); color: #c7d2fe; padding: 8px 10px; border-radius: 10px; font-weight: 700; font-size: 13px; }

.micro-badges { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; }
.micro-badge { padding: 8px 10px; border-radius: 10px; background: rgba(255,255,255,0.06); color: #e5e7eb; font-size: 12px; font-weight: 700; }

.progress-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
.progress-label { display: flex; justify-content: space-between; align-items: center; font-weight: 700; color: #e5e7eb; }
.progress-bar { width: 100%; height: 12px; background: rgba(255,255,255,0.06); border-radius: 10px; overflow: hidden; }
.progress-fill { height: 100%; width: 0%; background: linear-gradient(90deg, #8b5cf6, #22d3ee); transition: width 1.2s ease; border-radius: 10px; }

.audit-box-modern { background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.08); padding: 14px; border-radius: 12px; font-size: 14px; line-height: 1.6; white-space: pre-wrap; }
.audit-entry { margin-bottom: 6px; }

.tips-modern { background: rgba(255,255,255,0.02); border: 1px solid rgba(34,211,238,0.18); padding: 14px; border-radius: 12px; color: #e5e7eb; }
.tips-modern li { margin-bottom: 6px; }

.comp-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px,1fr)); gap: 12px; }
.comp-text { background: rgba(255,255,255,0.04); padding: 12px; border-radius: 12px; font-size: 14px; white-space: pre-wrap; border: 1px solid rgba(255,255,255,0.08); }

.action-btn { background: linear-gradient(135deg, #22d3ee, #0ea5e9); border: none; color: white; padding: 12px 16px; border-radius: 12px; font-weight: 800; cursor: pointer; box-shadow: 0 10px 24px rgba(14,165,233,0.28); margin-bottom: 14px; display: inline-flex; align-items: center; gap: 10px; }
.action-btn svg { width: 18px; height: 18px; }

.free-scan-card { display: flex; align-items: center; justify-content: space-between; gap: 14px; background: rgba(255,255,255,0.03); border: 1px solid rgba(34,211,238,0.12); padding: 14px 16px; border-radius: 14px; margin-bottom: 16px; box-shadow: var(--shadow); }
.free-scan-card h2 { margin: 0; font-weight: 800; }
.status-dot { width: 12px; height: 12px; border-radius: 50%; background: #22c55e; box-shadow: 0 0 0 4px rgba(34,197,94,0.15); }
.status-dot.used { background: #f97316; box-shadow: 0 0 0 4px rgba(249,115,22,0.15); }
.status-text { font-weight: 700; color: #e5e7eb; }

.serp-card { background: linear-gradient(145deg, rgba(34,211,238,0.05), rgba(79,70,229,0.05)); border: 1px solid rgba(34,211,238,0.18); }
.serp-title { font-size: 16px; font-weight: 800; color: #f8fafc; margin: 4px 0; }
.serp-url { color: #67e8f9; font-size: 13px; }
.serp-desc { color: #cbd5f5; font-size: 14px; line-height: 1.5; }

.readability-meter { margin-top: 10px; }
.readability-score { font-weight: 800; color: #67e8f9; }

.sidebar-ads .card { background: rgba(255,255,255,0.05); }
.sidebar-ads .card p { color: var(--muted); }

.info-modal-bg { display: none; position: fixed; inset: 0; background: rgba(6,11,26,0.7); align-items: center; justify-content: center; z-index: 99999; }
.info-modal { background: #0f172a; padding: 20px; border-radius: 14px; width: 92%; max-width: 420px; box-shadow: var(--shadow); border: 1px solid rgba(255,255,255,0.08); }
.info-modal h3 { margin-top: 0; }
.modal-close { background: linear-gradient(135deg, #8b5cf6, #22d3ee); color: white; border: none; padding: 10px 16px; border-radius: 10px; cursor: pointer; font-weight: 700; }

@media (max-width: 980px) {
    .page-wrapper { grid-template-columns: 1fr; }
    .analyzer-form { grid-template-columns: 1fr; }
    .score-shell { grid-template-columns: 1fr; }
}
</style>

<div class="seo-tags" aria-hidden="true">
    SEO Booster Pro, SEO dashboard, AI SEO analyzer, enterprise SEO audit, live SEO screenshot, structured data SEO, canonical tag checker, meta description length, H1 checker, keyword intelligence
</div>

<div id="modalBG" class="info-modal-bg">
    <div class="info-modal">
        <h3 id="modalTitle"></h3>
        <p id="modalText"></p>
        <button class="modal-close" onclick="closeModal()">Got it</button>
    </div>
</div>

<div class="dashboard-shell">
    <div class="dashboard-hero">
        <div class="hero-top">
            <div>
                <div class="breadcrumbs">/ SEO Booster Pro / Dashboard / Analyzer</div>
                <div class="dash-title">Elite SEO Intelligence Dashboard</div>
                <div class="dash-subtitle">An enterprise-grade cockpit that blends AI narration, live SERP previews, and technical depth. Built to impress stakeholders and surface fixes that move rankings.</div>
                <div class="hero-pills">
                    <span class="hero-pill">AI-led storytelling</span>
                    <span class="hero-pill">Live screenshot capture</span>
                    <span class="hero-pill">Semantic keyword graph</span>
                    <span class="hero-pill">Executive-ready PDFs</span>
                </div>
            </div>
            <div class="hero-actions">
                <button class="primary-btn" onclick="document.getElementById('urlInput').focus()">Start a new scan</button>
                <div class="hero-microcopy">Optimized for SEO teams who need trustworthy signals, built-in metadata hygiene, and clean exportable reports.</div>
            </div>
        </div>
    </div>

    <div class="page-wrapper">
        <div class="dashboard-container">

            {% if not subscribed %}
            <div class="upgrade-banner">
                <div>
                    <h3>Upgrade to SEO Booster Pro ‚ú®</h3>
                    <p>Unlimited scans, PDF exports, competitor tracking, and premium AI breakdowns.</p>
                </div>
                <a class="upgrade-btn" href="/pricing">Upgrade Now</a>
            </div>
            {% endif %}

            {% if not subscribed %}
            <div class="free-scan-card">
                <div>
                    <h2>üéÅ Free Scan Available</h2>
                    <p style="color: var(--muted);">One complimentary SEO scan to feel the premium workflow.</p>
                </div>
                <div style="display:flex;align-items:center;gap:10px;">
                    {% if scans_left == 2 or scans_left == 1 %}
                        <div class="status-dot"></div>
                        <span class="status-text">Not Used</span>
                    {% else %}
                        <div class="status-dot used"></div>
                        <span class="status-text">Used</span>
                    {% endif %}
                </div>
            </div>
            {% endif %}

            <section class="card analyzer-card" id="analyzer">
                <div class="section-title">üîç SEO Analyzer</div>
                <div class="section-sub">Drop in a URL, optional keyword, and competitor. We‚Äôll narrate findings like a senior search strategist, validate metadata, and deliver a live preview.</div>
                <div class="analyzer-form">
                    <div class="stack">
                        <input id="urlInput" type="url" class="input-field" placeholder="https://yourwebsite.com" aria-label="Website URL" />
                        <input id="keywordInput" type="text" class="input-field" placeholder="Target keyword (optional)" aria-label="Target keyword" />
                        <input id="compInput" type="url" class="input-field" placeholder="Competitor URL (optional, Pro)" aria-label="Competitor URL" />
                    </div>
                    <div class="stack">
                        <button id="analyzeBtn" class="primary-btn">Run Premium Analysis</button>
                        <div class="tagline"><span>Signal rich</span> Visual score, AI explainer, SERP preview, and metadata hygiene</div>
                    </div>
                </div>
            </section>

            <button id="pdfBtn" class="action-btn" style="display:none;">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="12" y1="18" x2="12" y2="12"/><line x1="9" y1="15" x2="15" y2="15"/></svg>
                Download PDF Report
            </button>

            <div id="resultsArea" style="display:none;">
                <div class="results-grid">

                    <div class="card score-card">
                        <div class="section-title">üìà Site Performance Score</div>
                        <div class="score-shell">
                            <div id="scoreCircle" class="score-circle"><div id="scoreInner" class="score-circle-inner">0</div></div>
                            <div class="score-meta">
                                <div class="badge neutral" id="wordBadge">Loading‚Ä¶</div>
                                <div class="badge neutral" id="descBadge">Meta description</div>
                                <div class="badge neutral" id="structureBadge">Structure</div>
                                <div class="micro-badges">
                                    <span class="micro-badge" id="readabilityBadge">Readability ‚Äî</span>
                                    <span class="micro-badge" id="schemaBadge">Schema ‚Äî</span>
                                    <span class="micro-badge" id="canonicalBadge">Canonical ‚Äî</span>
                                    <span class="micro-badge" id="viewportBadge">Mobile ‚Äî</span>
                                    <span class="micro-badge" id="altBadge">Alt text ‚Äî</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card ai-box">
                        <div class="ai-header">
                            <span>ü§ñ Fake AI Lead Analyst</span>
                            <span class="ai-pill" id="aiSignal">Executive brief</span>
                        </div>
                        <div class="ai-voice" id="aiTake">I‚Äôll narrate your strengths, risks, and what to fix next.</div>
                        <div class="ai-footnote">Built for founders, CMOs, and operators who need confidence in every on-page signal.</div>
                    </div>

                    <div class="card preview-card">
                        <div class="section-title">üñºÔ∏è Live Page Preview</div>
                        <img id="screenshotImage" src="" alt="Live screenshot preview" />
                        <div class="preview-note" id="screenshotNote">Fetching live preview‚Ä¶</div>
                    </div>

                    <div class="card intel-card">
                        <div class="section-title">üîé Page Intelligence</div>
                        <div class="intel-grid">
                            <div class="info-pill">Page title <span class="pill-sub" id="pageTitle">‚Äî</span></div>
                            <div class="info-pill">Meta description <span class="pill-sub" id="pageDescription">‚Äî</span></div>
                            <div class="info-pill">Word count <span class="pill-sub" id="wordCount">‚Äî</span></div>
                            <div class="info-pill">Primary headings <span class="pill-sub" id="primaryHeadings">‚Äî</span></div>
                        </div>
                        <div class="micro-badges">
                            <span class="micro-badge" id="metaLengths">Title & description length</span>
                            <span class="micro-badge" id="canonicalLink">Canonical ‚Äî</span>
                        </div>
                        <div class="keyword-pills" id="keywordPills"></div>
                    </div>

                    <div class="card serp-card">
                        <div class="section-title">üåê SERP Snippet Preview</div>
                        <div class="serp-url">{{ request.host_url | replace('https://','').replace('http://','') }}&hellip;</div>
                        <div class="serp-title" id="serpTitle">Your title will appear here</div>
                        <div class="serp-desc" id="serpDescription">We‚Äôll mirror the description length and tone so you see exactly what searchers read.</div>
                        <div class="readability-meter">
                            <span class="readability-score" id="readabilityScoreLabel">Readability ‚Äî</span>
                            <div class="progress-bar" style="margin-top:6px;"><div id="readabilityFill" class="progress-fill"></div></div>
                        </div>
                    </div>

                    <div class="card metrics-card">
                        <div class="section-title">üìä Detailed Breakdown</div>
                        <div class="progress-row">
                            <div>
                                <div class="progress-label">Content Quality</div>
                                <div class="progress-bar"><div id="pb-content" class="progress-fill"></div></div>
                            </div>
                            <div>
                                <div class="progress-label">Keyword Relevance</div>
                                <div class="progress-bar"><div id="pb-keyword" class="progress-fill"></div></div>
                            </div>
                        </div>
                        <div class="progress-row">
                            <div>
                                <div class="progress-label">Technical Health</div>
                                <div class="progress-bar"><div id="pb-tech" class="progress-fill"></div></div>
                            </div>
                            <div>
                                <div class="progress-label">On-Page Structure</div>
                                <div class="progress-bar"><div id="pb-onpage" class="progress-fill"></div></div>
                            </div>
                        </div>
                        <div style="margin-top:12px;">
                            <div class="progress-label">Link Health</div>
                            <div class="progress-bar"><div id="pb-links" class="progress-fill"></div></div>
                        </div>
                    </div>

                    <div class="card audit-card">
                        <div class="section-title">üßπ Executive Audit</div>
                        <div class="audit-box-modern" id="auditBox"></div>
                    </div>

                    <div class="card tips-card">
                        <div class="section-title">üí° Quick Wins Playbook</div>
                        <ul class="tips-modern" id="tipsBox"></ul>
                    </div>

                    <div class="card" id="compSection" style="display:none;">
                        <div class="section-title">ü§ù Competitor Pulse</div>
                        <div class="progress-row">
                            <div>
                                <div class="progress-label">Content Strength</div>
                                <div class="progress-bar"><div id="compContentBar" class="progress-fill"></div></div>
                            </div>
                            <div>
                                <div class="progress-label">Keyword Fit</div>
                                <div class="progress-bar"><div id="compKeywordBar" class="progress-fill"></div></div>
                            </div>
                        </div>
                        <div class="progress-row">
                            <div>
                                <div class="progress-label">Technical Health</div>
                                <div class="progress-bar"><div id="compTechnicalBar" class="progress-fill"></div></div>
                            </div>
                            <div>
                                <div class="progress-label">On-Page Structure</div>
                                <div class="progress-bar"><div id="compOnpageBar" class="progress-fill"></div></div>
                            </div>
                        </div>
                        <div style="margin-top:12px;">
                            <div class="progress-label">Link Health</div>
                            <div class="progress-bar"><div id="compLinksBar" class="progress-fill"></div></div>
                        </div>
                        <div class="comp-container" style="margin-top:12px;">
                            <div class="comp-text" id="compSummary">Competitor summary will appear here.</div>
                            <div class="comp-text">
                                <strong>Where they win</strong>
                                <div id="compAdv"></div>
                                <strong style="display:block; margin-top:10px;">Where you can beat them</strong>
                                <div id="compDisadv"></div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

        </div>

        <div class="sidebar-ads">
            {% if not subscribed %}
            <div class="card" style="position: sticky; top: 100px;">
                <div class="section-title">üöÄ Go Pro</div>
                <p>Unlock unlimited scans, PDFs, and competitor AI insights. No ads, just performance.</p>
                <a class="upgrade-btn" href="/pricing" style="display:inline-block; margin-top:10px;">Upgrade</a>
            </div>
            {% else %}
            <div class="card" style="position: sticky; top: 100px;">
                <div class="section-title">üèÅ Workflow Tips</div>
                <p>Bookmark this dashboard and add your competitor URLs to benchmark every release. Save PDFs before stakeholder reviews.</p>
                <p style="color: var(--muted);">Index-friendly markup and structured data keep this UI SEO-strong while you audit clients.</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
function openInfo(title, text) {
    document.getElementById("modalTitle").innerText = title;
    document.getElementById("modalText").innerText = text;
    document.getElementById("modalBG").style.display = "flex";
}
function closeModal() {
    document.getElementById("modalBG").style.display = "none";
}

const analyzeBtn = document.getElementById("analyzeBtn");
const pdfBtn = document.getElementById("pdfBtn");

analyzeBtn.onclick = async function () {
    const url = document.getElementById("urlInput").value;
    const keyword = document.getElementById("keywordInput").value;
    const competitor = document.getElementById("compInput").value;

    if (!url) return alert("Please enter a URL.");

    analyzeBtn.disabled = true;
    analyzeBtn.innerText = "Scanning‚Ä¶";

    let resp;
    try {
        resp = await fetch("/scan", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({url, keyword, competitor})
        });
    } catch (err) {
        analyzeBtn.disabled = false;
        analyzeBtn.innerText = "Run Premium Analysis";
        return alert("Network error. Please try again.");
    }

    analyzeBtn.disabled = false;
    analyzeBtn.innerText = "Run Premium Analysis";

    const data = await resp.json();

    if (data.error === "not_logged_in") return window.location.href = "/login";
    if (data.error === "limit") return openInfo("Upgrade Required","You‚Äôve used your free scans. Upgrade for unlimited scans and competitor breakdowns.");

    document.getElementById("resultsArea").style.display = "block";

    let finalScore = data.score;
    let inner = document.getElementById("scoreInner");
    let circle = document.getElementById("scoreCircle");
    let current = 0;

    let color = "#4f46e5";
    if (finalScore >= 80) color = "#22c55e";
    else if (finalScore >= 60) color = "#f59e0b";
    else color = "#ef4444";

    let interval = setInterval(() => {
        current++;
        inner.innerText = current;
        circle.style.background = `conic-gradient(${color} ${current * 3.6}deg, #1e293b 0deg)`;
        if (current >= finalScore) clearInterval(interval);
    }, 15);

    document.getElementById("pb-content").style.width = data.content + "%";
    document.getElementById("pb-keyword").style.width = data.keyword + "%";
    document.getElementById("pb-tech").style.width = data.technical + "%";
    document.getElementById("pb-onpage").style.width = data.onpage + "%";
    document.getElementById("pb-links").style.width = data.links + "%";

    let auditHTML = "";
    data.audit.split("\n").forEach(line => { if (line.trim()) auditHTML += `<div class="audit-entry">${line}</div>`; });
    document.getElementById("auditBox").innerHTML = auditHTML;

    let tipsHTML = "";
    data.tips.split("\n").forEach(tip => { if (tip.trim()) tipsHTML += `<li>${tip.replace("‚Ä¢ ","")}</li>`; });
    document.getElementById("tipsBox").innerHTML = tipsHTML;

    const meta = data.page_meta || {};
    document.getElementById("pageTitle").innerText = meta.title || "No title found";
    document.getElementById("pageDescription").innerText = meta.description || "No description found";
    document.getElementById("wordCount").innerText = meta.word_count ? `${meta.word_count} words` : "Word count unavailable";
    document.getElementById("primaryHeadings").innerText = (meta.h1 && meta.h1.length) ? meta.h1.join(" ¬∑ ") : "No H1 headings detected";

    const pillContainer = document.getElementById("keywordPills");
    pillContainer.innerHTML = "";
    (meta.top_terms || []).forEach(term => {
        const pill = document.createElement("span");
        pill.innerText = term;
        pillContainer.appendChild(pill);
    });

    document.getElementById("wordBadge").innerText = meta.word_count ? `${meta.word_count} words indexed` : "Word count unknown";
    document.getElementById("descBadge").innerText = meta.description && meta.description !== "No meta description detected" ? "Meta description detected" : "Add a meta description";
    document.getElementById("structureBadge").innerText = (meta.h1 && meta.h1.length === 1) ? "Solid H1 structure" : "Review heading structure";

    document.getElementById("readabilityBadge").innerText = meta.readability_score ? `Readability ${meta.readability_score}/100` : "Readability ‚Äî";
    document.getElementById("schemaBadge").innerText = meta.schema_present ? "Schema detected" : "Add structured data";
    document.getElementById("canonicalBadge").innerText = meta.canonical_url ? "Canonical set" : "Add canonical tag";
    document.getElementById("canonicalLink").innerText = meta.canonical_url ? meta.canonical_url : "No canonical tag detected";
    document.getElementById("viewportBadge").innerText = meta.viewport_present ? "Mobile viewport ready" : "Add viewport meta";
    document.getElementById("altBadge").innerText = (meta.alt_coverage || meta.alt_coverage === 0) ? `${meta.alt_coverage}% media labeled` : "No images detected";

    document.getElementById("metaLengths").innerText = `Title: ${meta.title_length || 0} chars ‚Ä¢ Description: ${meta.description_length || 0} chars ‚Ä¢ H1s: ${meta.h1_count || 0}`;

    document.getElementById("serpTitle").innerText = meta.title || "Untitled page";
    document.getElementById("serpDescription").innerText = meta.description && meta.description !== "No meta description detected" ? meta.description : "Add a compelling meta description to control your SERP presence.";
    document.getElementById("readabilityScoreLabel").innerText = meta.readability_score ? `Readability ${meta.readability_score}/100` : "Readability ‚Äî";
    document.getElementById("readabilityFill").style.width = meta.readability_score ? `${meta.readability_score}%` : "0%";

    const aiNarrative = buildAiNarrative(finalScore, meta, data);
    document.getElementById("aiTake").innerText = aiNarrative;
    document.getElementById("aiSignal").innerText = finalScore >= 80 ? "Investor-ready" : finalScore >= 60 ? "Needs polish" : "Critical fixes";

    const screenshotUrl = `https://image.thum.io/get/width/1200/crop/900/${encodeURIComponent(url)}`;
    const screenshotEl = document.getElementById("screenshotImage");
    const screenshotNote = document.getElementById("screenshotNote");
    screenshotEl.src = screenshotUrl;
    screenshotNote.innerText = "Live capture from your page.";
    screenshotEl.onerror = () => {
        screenshotNote.innerText = "Live preview unavailable (blocked by site). SEO insights still accurate.";
    };

    if (!competitor || !data.competitor_data) {
        document.getElementById("compSection").style.display = "none";
    } else {
        let c = data.competitor_data;
        document.getElementById("compSection").style.display = "block";
        document.getElementById("compContentBar").style.width = c.content + "%";
        document.getElementById("compKeywordBar").style.width = c.keyword + "%";
        document.getElementById("compTechnicalBar").style.width = c.technical + "%";
        document.getElementById("compOnpageBar").style.width = c.onpage + "%";
        document.getElementById("compLinksBar").style.width = c.links + "%";
        document.getElementById("compSummary").innerText = data.competitor_summary || "";
        document.getElementById("compAdv").innerText = data.competitor_advantages || "";
        document.getElementById("compDisadv").innerText = data.competitor_disadvantages || "";
    }

    document.getElementById("pdfBtn").style.display = "inline-flex";
};

function buildAiNarrative(score, meta, data) {
    const health = score >= 80 ? "strong and investor-ready" : score >= 60 ? "promising but needs polish" : "risky for organic growth";
    const desc = meta.description && meta.description !== "No meta description detected" ? "Meta description is present; tune it for clicks." : "No meta description detected‚Äîthis is low-hanging fruit.";
    const heading = (meta.h1 && meta.h1.length === 1) ? "Heading hierarchy is on-brand." : "Heading hierarchy needs a single, focused H1.";
    const keyword = data.keyword >= 70 ? "Keywords align with intent." : "Keyword signals are weak‚Äîre-balance copy and headings.";
    const schema = meta.schema_present ? "Structured data is in place‚Äîenhance it for rich results." : "Add JSON-LD to claim rich results.";
    return `I‚Äôd pitch this as ${health}. ${desc} ${heading} ${schema} ${keyword} Push semantic depth with the highlighted keywords and tighten technical basics to unlock higher intent traffic.`;
}

pdfBtn.onclick = async function () {
    const url = document.getElementById("urlInput").value;
    const keyword = document.getElementById("keywordInput").value;
    const competitor = document.getElementById("compInput").value;

    const payload = {
        url: url,
        keyword: keyword,
        competitor: competitor,
        score: document.getElementById("scoreInner").innerText,
        content: document.getElementById("pb-content").style.width.replace("%",""),
        keyword_score: document.getElementById("pb-keyword").style.width.replace("%",""),
        technical: document.getElementById("pb-tech").style.width.replace("%",""),
        onpage: document.getElementById("pb-onpage").style.width.replace("%",""),
        links: document.getElementById("pb-links").style.width.replace("%",""),
        audit: document.getElementById("auditBox").innerText,
        tips: Array.from(document.querySelectorAll("#tipsBox li")).map(li => li.innerText).join("\n")
    };

    let resp;
    try {
        resp = await fetch("/export-pdf", { method: "POST", headers: {"Content-Type": "application/json"}, body: JSON.stringify(payload) });
    } catch (err) { return alert("PDF failed to generate (network error)."); }

    if (resp.status === 403) { return openInfo("Upgrade Required","PDF reports are for Pro members only."); }
    if (!resp.ok) { return alert("PDF failed to generate."); }

    const blob = await resp.blob();
    const urlObj = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = urlObj; a.download = "seo_report.pdf"; a.click();
    URL.revokeObjectURL(urlObj);
};
</script>

{% endblock %}
