{% extends "base.html" %}
{% block content %}

<style>
/* =========================================================
   GLOBAL LAYOUT
========================================================= */
body {
    background: #f7f7fb;
    font-family: 'Inter', sans-serif;
    color: #222;
}

/* NAVBAR */
.navbar {
    width: 100%;
    padding: 18px 40px;
    background: white;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 1px 4px rgba(0,0,0,0.07);
    position: sticky;
    top: 0;
    z-index: 10;
}
.nav-left { font-size: 22px; font-weight: 700; color: #6A4CFF; }
.nav-links a {
    margin-left: 25px;
    text-decoration: none;
    color: #333;
    font-weight: 500;
}
.nav-links a:hover { color: #6A4CFF; }

/* =========================================================
   UPGRADE BANNER (FREE USERS ONLY)
========================================================= */
.upgrade-banner {
    width: 100%;
    background: #fff7e6;
    border-bottom: 2px solid #ffd27f;
    padding: 18px 0;
    margin-bottom: 20px;
}
.upgrade-banner-inner {
    max-width: 900px;
    margin: auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.upgrade-banner h3 {
    margin: 0;
    font-size: 20px;
    color: #6A4CFF;
    font-weight: 700;
}
.upgrade-banner p {
    margin: 3px 0 0 0;
    font-size: 14px;
    opacity: 0.8;
}
.upgrade-btn {
    background: #6A4CFF;
    color: white;
    padding: 12px 22px;
    border-radius: 10px;
    font-weight: 700;
    font-size: 15px;
    text-decoration: none;
    white-space: nowrap;
}

/* =========================================================
   ‚ú® PREMIUM DASHBOARD HERO (NEW)
========================================================= */
.dashboard-hero {
    background: linear-gradient(135deg, #7A5BFF, #6A4CFF);
    padding: 60px 30px;
    border-radius: 18px;
    text-align: center;
    margin-bottom: 35px;
    color: white;
    box-shadow: 0 6px 18px rgba(0,0,0,0.12);
}

.dash-title {
    font-size: 52px;
    font-weight: 800;
    letter-spacing: -1px;
    margin-bottom: 10px;
}

.dash-subtitle {
    font-size: 20px;
    opacity: 0.95;
}

@media (max-width: 600px) {
    .dash-title { font-size: 38px; }
    .dash-subtitle { font-size: 16px; }
}

/* =========================================================
   PAGE WRAPPER WITH SIDEBAR ADS
========================================================= */
.page-wrapper {
    max-width: 1300px;
    margin: auto;
    display: flex;
    gap: 25px;
}

/* MAIN CONTENT */
.dashboard-container {
    width: 100%;
    max-width: 900px;
    padding: 20px;
}

/* RIGHT SIDEBAR ADS */
.sidebar-ads {
    width: 320px;
    position: sticky;
    top: 110px;
    height: fit-content;
}
.ad-box {
    background: white;
    padding: 12px;
    border-radius: 14px;
    margin-bottom: 20px;
    box-shadow: 0 3px 8px rgba(0,0,0,0.08);
    text-align: center;
}
.ad-label {
    font-size: 13px;
    font-weight: 600;
    opacity: 0.6;
    margin-bottom: 8px;
}

/* =========================================================
   CARDS
========================================================= */
.card {
    background: white;
    border-radius: 14px;
    padding: 25px;
    margin-bottom: 30px;
    box-shadow: 0 3px 8px rgba(0,0,0,0.08);
}
.section-title {
    font-size: 22px;
    font-weight: 600;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
}

/* FREE & PRO BADGES */
.badge-free {
    padding: 4px 10px;
    border: 2px solid #6A4CFF;
    border-radius: 20px;
    font-size: 13px;
    color: #6A4CFF;
}
.badge-pro {
    padding: 4px 10px;
    background: #6A4CFF;
    border-radius: 20px;
    font-size: 13px;
    color: white;
    display: flex;
    align-items: center;
}

/* =========================================================
   SCORE CIRCLES
========================================================= */
.score-wrapper {
    display: flex;
    justify-content: center;
    align-items: center;
}
.score-circle,
.comp-score-circle {
    width: 160px;
    height: 160px;
    border-radius: 50%;
    background: conic-gradient(#ddd 0deg, #ddd 360deg);
    display: flex;
    justify-content: center;
    align-items: center;
}
.score-circle-inner,
.comp-score-inner {
    width: 120px;
    height: 120px;
    background: white;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 36px;
    font-weight: 700;
}

/* =========================================================
   PROGRESS BARS
========================================================= */
.progress-block { margin: 12px 0; }
.progress-label { font-weight: 600; margin-bottom: 6px; }
.progress-bar {
    width: 100%;
    height: 16px;
    background: #eee;
    border-radius: 10px;
    overflow: hidden;
}
.progress-fill {
    height: 100%;
    width: 0%;
    background: #6A4CFF;
    transition: width 1.2s ease;
    border-radius: 10px;
}

/* =========================================================
   SIDE-BY-SIDE SCORE CARDS
========================================================= */
.top-score-container {
    display: flex;
    gap: 20px;
    justify-content: space-between;
}
.top-score-box { width: 48%; }

@media (max-width: 1000px) {
    .page-wrapper { flex-direction: column; }
    .sidebar-ads { width: 100%; position: relative; top: 0; }
    .dashboard-container { width: 100%; }
}
@media (max-width: 768px) {
    .top-score-container { flex-direction: column; }
    .top-score-box { width: 100%; }
}

/* =========================================================
   COMPETITOR SECTION
========================================================= */
#compSection { display: none; }

.comp-container {
    display: flex;
    justify-content: space-between;
    gap: 20px;
}
.comp-card { width: 48%; }
.comp-text {
    background: #fafafa;
    padding: 12px;
    border-radius: 10px;
    font-size: 15px;
    white-space: pre-wrap;
}
@media (max-width: 768px) {
    .comp-container { flex-direction: column; }
    .comp-card { width: 100%; }
}
</style>


<!-- =========================================================
     NAVIGATION
========================================================= -->
<div class="navbar">
    <div class="nav-left">SEO Booster Pro</div>
    <div class="nav-links">
        <a href="/dashboard">Dashboard</a>
        <a href="/settings">Settings</a>
        <a href="/logout">Logout</a>
    </div>
</div>


<!-- =========================================================
     FREE USER ‚Äî UPGRADE BANNER
========================================================= -->
{% if not subscribed %}
<div class="upgrade-banner">
    <div class="upgrade-banner-inner">
        <div>
            <h3>Upgrade to SEO Booster Pro ‚ú®</h3>
            <p>Unlimited scans, unlimited PDF exports, no ads, full competitor analytics.</p>
        </div>

        <a href="/pricing" class="upgrade-btn">Upgrade to Pro</a>
    </div>
</div>
{% endif %}


<!-- =========================================================
     ‚ú® NEW PREMIUM HERO BANNER
========================================================= -->
<div class="dashboard-hero">
    <h1 class="dash-title">SEO Dashboard</h1>
    <p class="dash-subtitle">Instant AI-powered insights to improve your rankings</p>
</div>


<!-- =========================================================
     PAGE WRAPPER ‚Äî MAIN + SIDEBAR ADS
========================================================= -->
<div class="page-wrapper">


    <!-- =====================================================
         MAIN DASHBOARD LEFT SIDE
    ====================================================== -->
    <div class="dashboard-container">

        {% if not subscribed %}
        <div class="card">
            <div class="section-title">‚ö† Free Plan Limits</div>

            <p><strong>Scans:</strong> {{ 2 - user.scans_used if 2 - user.scans_used > 0 else 0 }} / 2 left</p>
            <p><strong>PDF Exports:</strong> {{ pdf_left }} / 1 left</p>
        </div>
        {% endif %}

        <!-- ANALYZER -->
        <div class="card">
            <div class="section-title">
                üîç SEO Analyzer
                {% if subscribed %}
                    <span class="badge-pro">‚≠ê PRO ‚Äì Unlimited Scans</span>
                {% else %}
                    <span class="badge-free">Free ‚Äì {{ scans_left }} / 2 left</span>
                {% endif %}
            </div>

            <div style="display:flex; gap:10px; margin-bottom:12px;">
                <input id="urlInput" type="url" placeholder="Your website URL‚Ä¶" style="flex:1; padding:12px; border:1px solid #ccc; border-radius:8px;">
                <button id="analyzeBtn" style="background:#6A4CFF;color:white;padding:12px 18px;border-radius:8px;border:none;">Analyze</button>
            </div>

            <input id="keywordInput" type="text" placeholder="Keyword (optional)" style="width:100%;padding:12px;border:1px solid #ccc;border-radius:8px;margin-bottom:12px;">
            <input id="compInput" type="url" placeholder="Competitor URL (optional)" style="width:100%;padding:12px;border:1px solid #ccc;border-radius:8px;">
        </div>
        <button id="pdfBtn" style="
             margin-top:12px;
             background:#2D8CFF;
             color:white;
             padding:12px 18px;
             border-radius:8px;
             border:none;
             display:none;
         ">
             Download PDF Report
         </button>


        <!-- RESULTS -->
        <div id="resultsArea" style="display:none;">

            <div class="top-score-container">

                <!-- Your Score -->
                <div class="top-score-box">
                    <div class="card">
                        <div class="section-title">üìà Your Site Score</div>
                        <div class="score-wrapper">
                            <div id="scoreCircle" class="score-circle">
                                <div id="scoreInner" class="score-circle-inner">0</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Competitor Score -->
                <div class="top-score-box">
                    <div id="compScoreCard" class="card" style="display:none;">
                        <div class="section-title">üèÜ Competitor Score</div>
                        <div class="score-wrapper">
                            <div id="compScoreCircle" class="comp-score-circle">
                                <div id="compScoreInner" class="comp-score-inner">0</div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>


            <!-- Breakdown -->
            <div class="card">
                <div class="section-title">üìä Detailed Breakdown</div>

                <div class="progress-block">
                    <div class="progress-label">Content Quality</div>
                    <div class="progress-bar"><div id="pb-content" class="progress-fill"></div></div>
                </div>

                <div class="progress-block">
                    <div class="progress-label">Keyword Relevance</div>
                    <div class="progress-bar"><div id="pb-keyword" class="progress-fill"></div></div>
                </div>

                <div class="progress-block">
                    <div class="progress-label">Technical Health</div>
                    <div class="progress-bar"><div id="pb-tech" class="progress-fill"></div></div>
                </div>

                <div class="progress-block">
                    <div class="progress-label">On-Page Structure</div>
                    <div class="progress-bar"><div id="pb-onpage" class="progress-fill"></div></div>
                </div>

                <div class="progress-block">
                    <div class="progress-label">Link Health</div>
                    <div class="progress-bar"><div id="pb-links" class="progress-fill"></div></div>
                </div>
            </div>


            <!-- Competitor Breakdown Section -->
            <div id="compSection" class="card">

                <div class="section-title">üèÅ Your Site vs Competitor</div>

                <div class="comp-container">

                    <!-- YOUR -->
                    <div class="comp-card">
                        <h3>Your Site</h3>

                        <div class="progress-block">
                            <div class="progress-label">Content</div>
                            <div class="progress-bar"><div id="yourContentBar" class="progress-fill"></div></div>
                        </div>

                        <div class="progress-block">
                            <div class="progress-label">Keyword</div>
                            <div class="progress-bar"><div id="yourKeywordBar" class="progress-fill"></div></div>
                        </div>

                        <div class="progress-block">
                            <div class="progress-label">Technical</div>
                            <div class="progress-bar"><div id="yourTechnicalBar" class="progress-fill"></div></div>
                        </div>

                        <div class="progress-block">
                            <div class="progress-label">On-Page</div>
                            <div class="progress-bar"><div id="yourOnpageBar" class="progress-fill"></div></div>
                        </div>

                        <div class="progress-block">
                            <div class="progress-label">Links</div>
                            <div class="progress-bar"><div id="yourLinksBar" class="progress-fill"></div></div>
                        </div>
                    </div>


                    <!-- COMP -->
                    <div class="comp-card">
                        <h3>Competitor</h3>

                        <div class="progress-block">
                            <div class="progress-label">Content</div>
                            <div class="progress-bar"><div id="compContentBar" class="progress-fill"></div></div>
                        </div>

                        <div class="progress-block">
                            <div class="progress-label">Keyword</div>
                            <div class="progress-bar"><div id="compKeywordBar" class="progress-fill"></div></div>
                        </div>

                        <div class="progress-block">
                            <div class="progress-label">Technical</div>
                            <div class="progress-bar"><div id="compTechnicalBar" class="progress-fill"></div></div>
                        </div>

                        <div class="progress-block">
                            <div class="progress-label">On-Page</div>
                            <div class="progress-bar"><div id="compOnpageBar" class="progress-fill"></div></div>
                        </div>

                        <div class="progress-block">
                            <div class="progress-label">Links</div>
                            <div class="progress-bar"><div id="compLinksBar" class="progress-fill"></div></div>
                        </div>
                    </div>

                </div>

                <br>

                <h3>üìò Summary</h3>
                <div id="compSummary" class="comp-text"></div>

                <h3>üìà Competitor Advantages</h3>
                <div id="compAdv" class="comp-text"></div>

                <h3>üõ† Your Advantages</h3>
                <div id="compDisadv" class="comp-text"></div>

            </div>


            <!-- AUDIT -->
            <div class="card">
                <div class="section-title">üßπ Site Audit</div>
                <pre id="auditBox" style="white-space:pre-wrap;font-size:15px;"></pre>
            </div>


            <!-- TIPS -->
            <div class="card">
                <div class="section-title">üí° Optimization Tips</div>
                <pre id="tipsBox" style="white-space:pre-wrap;font-size:15px;"></pre>
            </div>

        </div>
    </div>


    <!-- =====================================================
         RIGHT SIDEBAR ‚Äî ADS
    ====================================================== -->
    {% if not subscribed %}
    <div class="sidebar-ads">

        <div class="ad-box">
            <div class="ad-label">Advertisement</div>
            <ins class="adsbygoogle"
                 style="display:block;height:250px"
                 data-ad-client="ca-pub-1967195027765056"
                 data-ad-slot="TOP_AD_SLOT"></ins>
        </div>

        <div class="ad-box">
            <div class="ad-label">Advertisement</div>
            <ins class="adsbygoogle"
                 style="display:block;height:250px"
                 data-ad-client="ca-pub-1967195027765056"
                 data-ad-slot="BOTTOM_AD_SLOT"></ins>
        </div>

        <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
            (adsbygoogle = window.adsbygoogle || []).push({});
        </script>

    </div>
    {% endif %}

</div> <!-- end wrapper -->



<!-- =========================================================
     JAVASCRIPT ‚Äî ANALYZER LOGIC
========================================================= -->
<script>
document.getElementById("analyzeBtn").onclick = async function () {

    let url = document.getElementById("urlInput").value.trim();
    if (!url) return alert("Enter a valid URL.");

   let keyword = document.getElementById("keywordInput").value;
   let competitor = document.getElementById("compInput").value;

    const btn = document.getElementById("analyzeBtn");
    btn.disabled = true;
    btn.style.opacity = "0.6";
    btn.innerHTML = "Analyzing...";

    const res = await fetch("/scan", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ url, keyword, competitor })
    });

    const data = await res.json();

    btn.innerHTML = "Analyze";
    btn.style.opacity = "1";
    btn.disabled = false;

    if (data.error === "limit") {
        alert("You‚Äôve reached your 2 free scans for the month. Upgrade to Pro for unlimited scans.");
        return;
    }

    document.getElementById("resultsArea").style.display = "block";

    /* MAIN SCORE */
    let finalScore = data.score;
    let inner = document.getElementById("scoreInner");
    let circle = document.getElementById("scoreCircle");
    let current = 0;

    let color = "#6A4CFF";
    if (finalScore >= 80) color = "#09c372";
    else if (finalScore >= 60) color = "#f7b731";
    else color = "#fa5252";

    let interval = setInterval(() => {
        current++;
        inner.innerText = current;
        circle.style.background = `conic-gradient(${color} ${current * 3.6}deg, #ddd 0deg)`;
        if (current >= finalScore) clearInterval(interval);
    }, 15);


    document.getElementById("pb-content").style.width = data.content + "%";
    document.getElementById("pb-keyword").style.width = data.keyword + "%";
    document.getElementById("pb-tech").style.width = data.technical + "%";
    document.getElementById("pb-onpage").style.width = data.onpage + "%";
    document.getElementById("pb-links").style.width = data.links + "%";

    document.getElementById("auditBox").innerText = data.audit;
    document.getElementById("tipsBox").innerText = data.tips;

    if (!competitor || !data.competitor_data) {
        document.getElementById("compSection").style.display = "none";
        document.getElementById("compScoreCard").style.display = "none";
        return;
    }

    let c = data.competitor_data;

    document.getElementById("compSection").style.display = "block";
    document.getElementById("compScoreCard").style.display = "block";

    let compScore = Math.round(
        (c.content + c.keyword + c.technical + c.onpage + c.links) / 5
    );

    let compInner = document.getElementById("compScoreInner");
    let compCircle = document.getElementById("compScoreCircle");
    let compCurrent = 0;

    let compInterval = setInterval(() => {
        compCurrent++;
        compInner.innerText = compCurrent;
        compCircle.style.background = `conic-gradient(#2D8CFF ${compCurrent * 3.6}deg, #ddd 0deg)`;
        if (compCurrent >= compScore) clearInterval(compInterval);
    }, 15);

    document.getElementById("compContentBar").style.width = c.content + "%";
    document.getElementById("compKeywordBar").style.width = c.keyword + "%";
    document.getElementById("compTechnicalBar").style.width = c.technical + "%";
    document.getElementById("compOnpageBar").style.width = c.onpage + "%";
    document.getElementById("compLinksBar").style.width = c.links + "%";

    document.getElementById("compSummary").innerText = data.competitor_summary;
    document.getElementById("compAdv").innerText = data.competitor_advantages;
    document.getElementById("compDisadv").innerText = data.competitor_disadvantages;
    document.getElementById("pdfBtn").style.display = "block";

       document.getElementById("pdfBtn").style.display = "block";

    document.getElementById("pdfBtn").onclick = function () {
        window.location.href =
            `/pdf?url=${encodeURIComponent(url)}&keyword=${encodeURIComponent(keyword)}&competitor=${encodeURIComponent(competitor)}`;
    };

};  // <-- closes analyzeBtn onclick properly
</script>

    
{% endblock %}


