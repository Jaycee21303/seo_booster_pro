{% extends "base.html" %}
{% block content %}
<h2 class="fw-bold mb-3">Website Dashboard</h2>
<form method="POST">
    <input type="text" name="url" class="form-control mb-3"
           placeholder="Enter website URL (https://example.com)"
           value="{{ url }}"
           required>
    <button class="btn btn-primary mb-4">Analyze</button>
</form>
<h4 class="fw-bold">AI Tools</h4>
<div class="d-grid gap-2 mb-4">
    <button class="btn btn-outline-primary" onclick="runAITool('title')">Generate SEO Titles</button>
    <button class="btn btn-outline-primary" onclick="runAITool('meta')">Generate Meta Descriptions</button>
    <button class="btn btn-outline-primary" onclick="runAITool('rewrite')">Rewrite Homepage</button>
    <button class="btn btn-outline-primary" onclick="runAITool('keywords')">Generate Keywords</button>
</div>
<div id="ai-output" class="card p-3 shadow-sm" style="display:none; opacity:0; transition:opacity 0.4s;">
    <h5 class="fw-bold">AI Results</h5>
    <pre id="ai-text" style="white-space:pre-wrap;"></pre>
</div>
<script>
function runAITool(tool) {
    const url = document.querySelector("input[name='url']").value.trim();
    if (!url) {
        alert("Please enter a website URL first.");
        return;
    }
    let endpoint = `/ai/${tool}`;
    fetch(endpoint, {
        method: "POST",
        headers: {"Content-Type": "application/x-www-form-urlencoded"},
        body: `analyze_url=${encodeURIComponent(url)}`
    })
    .then(res => res.text())
    .then(data => {
        const box = document.getElementById("ai-output");
        document.getElementById("ai-text").textContent = data;
        box.style.display = "block";
        setTimeout(() => box.style.opacity = 1, 50);
    });
}
</script>
{% if url %}
<div class="text-center mt-4">
    <h5 class="fw-bold mb-2">Website Preview</h5>
    <img src="https://api.microlink.io/?url={{ url }}" 
         class="img-fluid rounded shadow-sm" 
         style="max-width: 600px;">
</div>
{% endif %}
{% if results %}
<div class="card p-4 shadow-sm mt-4">
    <h4 class="fw-bold mb-3">SEO Score</h4>
    <div class="score-circle mx-auto mb-3">
        <span>{{ results.score }}</span>
    </div>
    <h5 class="fw-bold mt-4">Issues Found</h5>
    <ul>
        {% for issue in results.issues %}
            <li>{{ issue }}</li>
        {% endfor %}
    </ul>
    <form method="POST" action="/download_report">
        <input type="hidden" name="report_data"
               value="SEO Score: {{ results.score }} | Issues: {{ results.issues }}">
        <button class="btn btn-success w-100 mt-3">Download PDF Report</button>
    </form>
</div>
{% endif %}
{% endblock %}