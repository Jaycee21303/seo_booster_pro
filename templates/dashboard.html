{% extends "base.html" %}
{% block content %}

<style>
/* ------------------------------------
   Basic Layout Styling
------------------------------------ */
body {
    background: #f7f7fb;
    font-family: 'Inter', sans-serif;
    color: #222;
}

.navbar {
    width: 100%;
    padding: 18px 40px;
    background: white;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 1px 4px rgba(0,0,0,0.07);
    position: sticky;
    top: 0;
    z-index: 10;
}

.nav-left { font-size: 22px; font-weight: 700; color: #6A4CFF; }

.nav-links a {
    margin-left: 25px;
    text-decoration: none;
    color: #333;
    font-weight: 500;
}
.nav-links a:hover { color: #6A4CFF; }

/* ------------------------------------
   Header
------------------------------------ */
.header-banner {
    width: 100%;
    padding: 45px 0;
    text-align: center;
    background: linear-gradient(135deg, #6A4CFF, #9C6BFF);
    color: white;
    margin-bottom: 35px;
}

.header-banner h1 {
    font-size: 38px;
    font-weight: 800;
    margin-bottom: 10px;
}

.dashboard-container {
    max-width: 950px;
    margin: auto;
    padding: 20px;
}

.card {
    background: white;
    border-radius: 14px;
    padding: 25px;
    margin-bottom: 30px;
    box-shadow: 0 3px 8px rgba(0,0,0,0.08);
}

.section-title {
    font-size: 22px;
    font-weight: 600;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 8px;
}

/* Badges */
.badge-free {
    padding: 4px 10px;
    border: 2px solid #6A4CFF;
    border-radius: 20px;
    font-size: 13px;
    color: #6A4CFF;
}

.badge-pro {
    padding: 4px 10px;
    background: #6A4CFF;
    border-radius: 20px;
    font-size: 13px;
    color: white;
    display: inline-flex;
    align-items: center;
    gap: 4px;
}

/* Score Circle */
.score-wrapper {
    display: flex;
    justify-content: center;
    align-items: center;
}

.score-circle {
    width: 160px;
    height: 160px;
    border-radius: 50%;
    background: conic-gradient(#ddd 0deg, #ddd 360deg);
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
}

.score-circle-inner {
    width: 120px;
    height: 120px;
    background: white;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 36px;
    font-weight: 700;
    color: #333;
    position: absolute;
}

/* Progress Bars */
.progress-block { margin: 12px 0; }
.progress-label { font-weight: 600; margin-bottom: 6px; }
.progress-bar {
    width: 100%;
    height: 16px;
    background: #eee;
    border-radius: 10px;
    overflow: hidden;
}
.progress-fill {
    height: 100%;
    width: 0%;
    background: #6A4CFF;
    transition: width 1.2s ease;
    border-radius: 10px;
}

/* Radar Chart */
.radar-container {
    width: 380px;
    height: 380px;
    margin: 25px auto;
    position: relative;
}
.radar-grid {
    position: absolute; inset: 0;
    border-radius: 50%;
    background: radial-gradient(circle, #f0f0ff 0%, #ffffff 70%);
}
.radar-shape {
    position: absolute;
    inset: 0;
    clip-path: polygon(
        50% 0%, 85% 20%, 100% 60%, 75% 100%,
        25% 100%, 0% 60%, 15% 20%
    );
    opacity: 0.22;
    transform-origin: center;
}
#yourRadar { background: #6A4CFF; }
#compRadar { background: #2D8CFF; }

/* Upgrade Modal */
#upgradeModal {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.55);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 999;
}

#upgradeCard {
    background: white;
    padding: 40px;
    border-radius: 18px;
    width: 360px;
    text-align: center;
    box-shadow: 0 4px 16px rgba(0,0,0,0.25);
}
</style>


<!-- Upgrade Modal -->
<div id="upgradeModal">
    <div id="upgradeCard">
        <h2 style="font-size:24px; font-weight:800; margin-bottom:10px;">
            Upgrade Required
        </h2>
        <p style="opacity:0.7; font-size:15px; margin-bottom:20px;">
            You‚Äôve used all 3 free scans. Upgrade to the PRO plan to unlock
            <strong>unlimited scans</strong> and full reports.
        </p>
        <a href="/pricing"
           style="display:block; padding:14px; background:#6A4CFF; color:white;
                  border-radius:10px; text-decoration:none; font-weight:700; margin-bottom:10px;">
            Upgrade to Pro
        </a>
        <button onclick="closeModal()" style="padding:10px 18px;
                border:none; background:#ddd; border-radius:8px;">
            Cancel
        </button>
    </div>
</div>


<!-- NAV -->
<div class="navbar">
    <div class="nav-left">SEO Booster Pro</div>
    <div class="nav-links">
        <a href="/dashboard">Dashboard</a>
        <a href="/settings">Settings</a>
        <a href="/logout">Logout</a>
    </div>
</div>


<!-- HEADER -->
<div class="header-banner">
    <h1>SEO Dashboard</h1>
    <p>Instant AI-powered insights to improve your rankings & visibility</p>
</div>


<!-- MAIN -->
<div class="dashboard-container">

    <!-- ANALYZER CARD -->
    <div class="card">
        <div class="section-title">
            üîç SEO Analyzer

            {% if subscribed %}
                <span class="badge-pro">‚≠ê PRO ‚Äì Unlimited Scans</span>
            {% else %}
                <span id="scanBadge" class="badge-free">Free ‚Äì {{ scans_left }} / 3 left</span>
            {% endif %}
        </div>

        <div style="display:flex; gap:10px; margin-bottom:12px;">
            <input id="urlInput" type="url" placeholder="Your website URL‚Ä¶"
                   style="flex:1; padding:12px; border:1px solid #ccc; border-radius:8px;">

            <button id="analyzeBtn"
                    style="background:#6A4CFF;color:white;padding:12px 18px;border-radius:8px;border:none;">
                Analyze
            </button>
        </div>

        <input id="keywordInput" type="text" placeholder="Keyword (optional)"
               style="width:100%;padding:12px;border:1px solid #ccc;border-radius:8px;margin-bottom:12px;">

        <input id="compInput" type="url" placeholder="Competitor URL (optional)"
               style="width:100%;padding:12px;border:1px solid #ccc;border-radius:8px;">
    </div>


    <!-- RESULTS -->
    <div id="resultsArea" style="display:none;">

        <!-- SCORE -->
        <div class="card">
            <div class="section-title">üìà SEO Score</div>
            <div class="score-wrapper">
                <div id="scoreCircle" class="score-circle">
                    <div id="scoreInner" class="score-circle-inner">0</div>
                </div>
            </div>
        </div>

        <!-- PDF BUTTON -->
        <div style="text-align:center; margin-top:25px;">
            <a href="/export-pdf"
            style="padding:14px 26px;
                   background:linear-gradient(135deg, #6A4CFF, #8F70FF);
                   color:white;border-radius:10px;text-decoration:none;
                   font-size:16px;font-weight:600;">
                üìÑ Download PDF Report
            </a>
        </div>

        <!-- BREAKDOWN -->
        <div class="card">
            <div class="section-title">üìä Detailed Breakdown</div>

            <div class="progress-block">
                <div class="progress-label">Content Quality</div>
                <div class="progress-bar"><div id="pb-content" class="progress-fill"></div></div>
            </div>

            <div class="progress-block">
                <div class="progress-label">Keyword Relevance</div>
                <div class="progress-bar"><div id="pb-keyword" class="progress-fill"></div></div>
            </div>

            <div class="progress-block">
                <div class="progress-label">Technical Health</div>
                <div class="progress-bar"><div id="pb-tech" class="progress-fill"></div></div>
            </div>

            <div class="progress-block">
                <div class="progress-label">On-Page Structure</div>
                <div class="progress-bar"><div id="pb-onpage" class="progress-fill"></div></div>
            </div>

            <div class="progress-block">
                <div class="progress-label">Link Health</div>
                <div class="progress-bar"><div id="pb-links" class="progress-fill"></div></div>
            </div>

        </div>

        <!-- AUDIT -->
        <div class="card">
            <div class="section-title">üßπ Site Audit</div>
            <pre id="auditBox" style="white-space:pre-wrap;font-size:15px;"></pre>
        </div>

        <!-- TIPS -->
        <div class="card">
            <div class="section-title">üí° Optimization Tips</div>
            <pre id="tipsBox" style="white-space:pre-wrap;font-size:15px;"></pre>
        </div>

    </div>
</div>


<!-- JS -->
<script>
function closeModal() {
    document.getElementById("upgradeModal").style.display = "none";
}

document.getElementById("analyzeBtn").onclick = async function () {

    let url = document.getElementById("urlInput").value.trim();
    if (!url) return alert("Enter a valid URL.");

    let keyword = document.getElementById("keywordInput").value;
    let competitor = document.getElementById("compInput").value;

    // Disable button + spinner
    const btn = document.getElementById("analyzeBtn");
    btn.disabled = true;
    btn.style.opacity = "0.6";
    btn.innerHTML = "Analyzing... ‚è≥";

    const res = await fetch("/scan", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({
            url: url,
            keyword: keyword,
            competitor: competitor
        })
    });

    const data = await res.json();

    // Re-enable button
    btn.innerHTML = "Analyze";
    btn.style.opacity = "1";
    btn.disabled = false;

    // LIMIT REACHED
    if (data.error === "limit") {
        document.getElementById("upgradeModal").style.display = "flex";
        return;
    }

    // Show results area
    document.getElementById("resultsArea").style.display = "block";

    // Update Score Circle
    let finalScore = data.score;
    let circle = document.getElementById("scoreCircle");
    let inner = document.getElementById("scoreInner");
    let current = 0;

    let color = "#6A4CFF";
    if (finalScore >= 80) color = "#09c372";
    else if (finalScore >= 60) color = "#f7b731";
    else color = "#fa5252";

    let interval = setInterval(() => {
        current++;
        inner.innerText = current;
        circle.style.background = `conic-gradient(${color} ${current * 3.6}deg, #ddd 0deg)`;
        if (current >= finalScore) clearInterval(interval);
    }, 15);

    // Progress Bars
    document.getElementById("pb-content").style.width = data.content + "%";
    document.getElementById("pb-keyword").style.width = data.keyword + "%";
    document.getElementById("pb-tech").style.width = data.technical + "%";
    document.getElementById("pb-onpage").style.width = data.onpage + "%";
    document.getElementById("pb-links").style.width = data.links + "%";

    // Audit + Tips
    document.getElementById("auditBox").innerText = data.audit;
    document.getElementById("tipsBox").innerText = data.tips;
};
</script>

{% endblock %}

